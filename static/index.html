<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Job Matcher - LinkedIn Resume Analyzer</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Progress Bar Component
        const ProgressBar = ({ progress, message, error }) => (
            <div className="w-full bg-gray-200 rounded-full h-3 mb-4">
                <div 
                    className={`progress-bar h-3 rounded-full ${error ? 'bg-red-500' : 'bg-blue-500'}`}
                    style={{ width: `${progress}%` }}
                ></div>
                <p className={`text-sm mt-2 ${error ? 'text-red-600' : 'text-gray-600'}`}>
                    {error || message}
                </p>
            </div>
        );

        // Job Results Component
        const JobResults = ({ results, summary }) => (
            <div className="space-y-6">
                <div className="bg-white rounded-lg p-6 card-shadow">
                    <h3 className="text-xl font-bold mb-4 text-gray-800">üìä Analysis Summary</h3>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div className="text-center p-4 bg-blue-50 rounded-lg">
                            <div className="text-2xl font-bold text-blue-600">{summary.total_jobs}</div>
                            <div className="text-sm text-gray-600">Total Jobs</div>
                        </div>
                        <div className="text-center p-4 bg-green-50 rounded-lg">
                            <div className="text-2xl font-bold text-green-600">{summary.high_matches}</div>
                            <div className="text-sm text-gray-600">High Matches (80+)</div>
                        </div>
                        <div className="text-center p-4 bg-yellow-50 rounded-lg">
                            <div className="text-2xl font-bold text-yellow-600">{summary.medium_matches}</div>
                            <div className="text-sm text-gray-600">Medium Matches (60-79)</div>
                        </div>
                        <div className="text-center p-4 bg-purple-50 rounded-lg">
                            <div className="text-2xl font-bold text-purple-600">{Math.round(summary.average_score)}</div>
                            <div className="text-sm text-gray-600">Average Score</div>
                        </div>
                    </div>
                </div>

                <div className="bg-white rounded-lg p-6 card-shadow">
                    <h3 className="text-xl font-bold mb-4 text-gray-800">üéØ Top Job Matches</h3>
                    <div className="space-y-4">
                        {results.slice(0, 10).map((job, index) => (
                            <div key={job.job_id} className="border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                <div className="flex justify-between items-start mb-2">
                                    <div className="flex-1">
                                        <h4 className="font-semibold text-lg text-gray-800">
                                            #{index + 1} {job.job_title || 'Unknown Title'}
                                        </h4>
                                        <p className="text-gray-600">{job.company || 'Unknown Company'}</p>
                                        <div className="mt-2">
                                            <a 
                                                href={job.job_url || `https://www.linkedin.com/jobs/view/${job.job_id}`}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="text-blue-600 hover:text-blue-800 text-sm underline break-all"
                                            >
                                                üîó {job.job_url || `https://www.linkedin.com/jobs/view/${job.job_id}`}
                                            </a>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className={`text-2xl font-bold ${
                                            job.overall_score >= 80 ? 'text-green-600' :
                                            job.overall_score >= 60 ? 'text-yellow-600' : 'text-red-600'
                                        }`}>
                                            {job.overall_score}/100
                                        </div>
                                        <div className={`text-sm px-2 py-1 rounded ${
                                            job.priority === 'HIGH' ? 'bg-red-100 text-red-800' :
                                            job.priority === 'MEDIUM' ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-gray-100 text-gray-800'
                                        }`}>
                                            {job.priority}
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-3 text-sm">
                                    <div>Technical: {job.technical_skills_score}/100</div>
                                    <div>Experience: {job.experience_score}/100</div>
                                    <div>Domain: {job.domain_score}/100</div>
                                    <div>Responsibilities: {job.responsibilities_score}/100</div>
                                </div>

                                <div className="grid md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <strong className="text-green-600">‚úÖ Strengths:</strong>
                                        <ul className="list-disc list-inside text-gray-600 mt-1">
                                            {(job.strengths || []).slice(0, 3).map((strength, i) => (
                                                <li key={i}>{strength}</li>
                                            ))}
                                        </ul>
                                    </div>
                                    <div>
                                        <strong className="text-red-600">‚ùå Gaps:</strong>
                                        <ul className="list-disc list-inside text-gray-600 mt-1">
                                            {(job.gaps || []).slice(0, 3).map((gap, i) => (
                                                <li key={i}>{gap}</li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>

                                {job.missing_keywords && job.missing_keywords.length > 0 && (
                                    <div className="mt-3">
                                        <strong className="text-blue-600">üîë Missing Keywords:</strong>
                                        <div className="flex flex-wrap gap-1 mt-1">
                                            {job.missing_keywords.slice(0, 8).map((keyword, i) => (
                                                <span key={i} className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">
                                                    {keyword}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        // Main App Component
        const App = () => {
            const [currentStep, setCurrentStep] = useState(1);
            const [processStatus, setProcessStatus] = useState({
                status: 'idle',
                progress: 0,
                message: '',
                error: null
            });
            const [jobParams, setJobParams] = useState({
                keywords: 'AI Engineer',
                location: 'United States',
                geoId: '103644278',
                distance: 25,
                f_TPR: 'r86400',
                sortBy: 'R',
                f_E: 4,
                f_SB2: 1,
                max_jobs: 10
            });
            const [generatedUrl, setGeneratedUrl] = useState('');
            const [results, setResults] = useState(null);
            const [summary, setSummary] = useState(null);

            // Poll for status updates
            useEffect(() => {
                const interval = setInterval(async () => {
                    if (processStatus.status === 'processing') {
                        try {
                            const response = await fetch('/api/status');
                            const status = await response.json();
                            setProcessStatus(status);
                            
                            if (status.status === 'completed' && status.results) {
                                if (currentStep === 2 && status.results.job_count) {
                                    // Job collection completed
                                    setTimeout(() => setCurrentStep(3), 2000);
                                } else if (currentStep === 3 && status.results.total_jobs) {
                                    // Analysis completed
                                    loadResults();
                                }
                            }
                        } catch (error) {
                            console.error('Status poll error:', error);
                        }
                    }
                }, 2000);

                return () => clearInterval(interval);
            }, [processStatus.status, currentStep]);

            const handleResumeUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const formData = new FormData();
                formData.append('resume', file);

                setProcessStatus({ status: 'processing', progress: 0, message: 'Uploading resume...' });

                try {
                    const response = await fetch('/api/upload-resume', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        setCurrentStep(2);
                        setProcessStatus({ status: 'completed', progress: 100, message: 'Resume uploaded successfully!' });
                    } else {
                        setProcessStatus({ status: 'error', error: result.error, progress: 0 });
                    }
                } catch (error) {
                    setProcessStatus({ status: 'error', error: error.message, progress: 0 });
                }
            };

            const generateLinkedInUrl = async () => {
                try {
                    const response = await fetch('/api/generate-url', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(jobParams)
                    });

                    const result = await response.json();
                    if (result.success) {
                        setGeneratedUrl(result.url);
                    }
                } catch (error) {
                    console.error('URL generation error:', error);
                }
            };

            const collectJobs = async () => {
                if (!generatedUrl) {
                    await generateLinkedInUrl();
                    return;
                }

                setProcessStatus({ status: 'processing', progress: 10, message: 'Starting job collection...' });

                try {
                    const response = await fetch('/api/collect-jobs', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: generatedUrl, max_jobs: jobParams.max_jobs })
                    });

                    const result = await response.json();
                    if (!result.success) {
                        setProcessStatus({ status: 'error', error: result.error, progress: 0 });
                    }
                } catch (error) {
                    setProcessStatus({ status: 'error', error: error.message, progress: 0 });
                }
            };

            const analyzeMatches = async () => {
                setProcessStatus({ status: 'processing', progress: 10, message: 'Starting analysis...' });

                try {
                    const response = await fetch('/api/analyze-matches', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    const result = await response.json();
                    if (!result.success) {
                        setProcessStatus({ status: 'error', error: result.error, progress: 0 });
                    }
                } catch (error) {
                    setProcessStatus({ status: 'error', error: error.message, progress: 0 });
                }
            };

            const loadResults = async () => {
                try {
                    const response = await fetch('/api/results');
                    const data = await response.json();
                    
                    if (data.success) {
                        setResults(data.results);
                        setSummary(data.summary);
                        setCurrentStep(4);
                        setProcessStatus({ status: 'completed', progress: 100, message: 'Analysis complete!' });
                    }
                } catch (error) {
                    console.error('Results loading error:', error);
                }
            };

            const resetProcess = async () => {
                try {
                    await fetch('/api/reset', { method: 'POST' });
                    setCurrentStep(1);
                    setProcessStatus({ status: 'idle', progress: 0, message: '' });
                    setResults(null);
                    setSummary(null);
                    setGeneratedUrl('');
                } catch (error) {
                    console.error('Reset error:', error);
                }
            };

            const downloadFile = (filename) => {
                window.open(`/api/download/${filename}`, '_blank');
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="gradient-bg text-white py-8">
                        <div className="container mx-auto px-4">
                            <h1 className="text-4xl font-bold mb-2">ü§ñ AI Job Matcher</h1>
                            <p className="text-xl opacity-90">Intelligent LinkedIn Resume-Job Matching System</p>
                        </div>
                    </div>

                    {/* Progress Steps */}
                    <div className="container mx-auto px-4 py-8">
                        <div className="flex justify-center mb-8">
                            <div className="flex items-center space-x-4">
                                {[1, 2, 3, 4].map((step) => (
                                    <div key={step} className="flex items-center">
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${
                                            currentStep >= step ? 'bg-blue-500' : 'bg-gray-300'
                                        }`}>
                                            {step}
                                        </div>
                                        {step < 4 && <div className={`w-12 h-1 ${currentStep > step ? 'bg-blue-500' : 'bg-gray-300'}`}></div>}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Step Content */}
                        <div className="max-w-4xl mx-auto">
                            {/* Step 1: Upload Resume */}
                            {currentStep === 1 && (
                                <div className="bg-white rounded-lg p-8 card-shadow">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">
                                        üìÑ Step 1: Upload Your Resume
                                    </h2>
                                    <div className="text-center">
                                        <div className="border-2 border-dashed border-gray-300 rounded-lg p-12 hover:border-blue-400 transition-colors">
                                            <i className="fas fa-file-pdf text-6xl text-gray-400 mb-4"></i>
                                            <p className="text-lg text-gray-600 mb-4">
                                                Upload your resume PDF to get started
                                            </p>
                                            <input
                                                type="file"
                                                accept=".pdf"
                                                onChange={handleResumeUpload}
                                                className="hidden"
                                                id="resume-upload"
                                            />
                                            <label
                                                htmlFor="resume-upload"
                                                className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg cursor-pointer inline-block transition-colors"
                                            >
                                                Choose PDF File
                                            </label>
                                        </div>
                                        
                                        {processStatus.status === 'processing' && (
                                            <div className="mt-6">
                                                <ProgressBar 
                                                    progress={processStatus.progress} 
                                                    message={processStatus.message} 
                                                />
                                            </div>
                                        )}

                                        {processStatus.status === 'error' && (
                                            <div className="mt-6 p-4 bg-red-50 rounded-lg">
                                                <p className="text-red-600">‚ùå {processStatus.error}</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Step 2: Configure Job Search */}
                            {currentStep === 2 && (
                                <div className="bg-white rounded-lg p-8 card-shadow">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">
                                        üîç Step 2: Configure Job Search
                                    </h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Keywords
                                            </label>
                                            <input
                                                type="text"
                                                value={jobParams.keywords}
                                                onChange={(e) => setJobParams({...jobParams, keywords: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="e.g., AI Engineer, Machine Learning"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Location
                                            </label>
                                            <input
                                                type="text"
                                                value={jobParams.location}
                                                onChange={(e) => setJobParams({...jobParams, location: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="e.g., United States, New York"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Experience Level
                                            </label>
                                            <select
                                                value={jobParams.f_E}
                                                onChange={(e) => setJobParams({...jobParams, f_E: parseInt(e.target.value)})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value={1}>Internship</option>
                                                <option value={2}>Entry Level</option>
                                                <option value={3}>Associate</option>
                                                <option value={4}>Mid-Senior Level</option>
                                                <option value={5}>Director</option>
                                                <option value={6}>Executive</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Salary Range
                                            </label>
                                            <select
                                                value={jobParams.f_SB2}
                                                onChange={(e) => setJobParams({...jobParams, f_SB2: parseInt(e.target.value)})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value={1}>$40,000+</option>
                                                <option value={2}>$60,000+</option>
                                                <option value={3}>$80,000+</option>
                                                <option value={4}>$100,000+</option>
                                                <option value={5}>$120,000+</option>
                                                <option value={6}>$140,000+</option>
                                                <option value={7}>$160,000+</option>
                                                <option value={8}>$180,000+</option>
                                                <option value={9}>$200,000+</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Time Period
                                            </label>
                                            <select
                                                value={jobParams.f_TPR}
                                                onChange={(e) => setJobParams({...jobParams, f_TPR: e.target.value})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value="">Any time</option>
                                                <option value="r86400">Past 24 hours</option>
                                                <option value="r604800">Past week</option>
                                                <option value="r2592000">Past month</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Max Jobs to Collect
                                            </label>
                                            <input
                                                type="number"
                                                value={jobParams.max_jobs}
                                                onChange={(e) => setJobParams({...jobParams, max_jobs: parseInt(e.target.value)})}
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                min="1"
                                                max="50"
                                            />
                                        </div>
                                    </div>

                                    {generatedUrl && (
                                        <div className="mb-6 p-4 bg-blue-50 rounded-lg">
                                            <h4 className="font-medium text-blue-800 mb-2">Generated LinkedIn URL:</h4>
                                            <p className="text-sm text-blue-600 break-all">{generatedUrl}</p>
                                        </div>
                                    )}

                                    <div className="flex space-x-4">
                                        <button
                                            onClick={generateLinkedInUrl}
                                            className="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg transition-colors"
                                        >
                                            üîó Generate URL
                                        </button>
                                        <button
                                            onClick={collectJobs}
                                            disabled={processStatus.status === 'processing'}
                                            className="bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg transition-colors"
                                        >
                                            {processStatus.status === 'processing' ? 'Collecting...' : 'üöÄ Collect Jobs'}
                                        </button>
                                    </div>

                                    {processStatus.status === 'processing' && (
                                        <div className="mt-6">
                                            <ProgressBar 
                                                progress={processStatus.progress} 
                                                message={processStatus.message} 
                                            />
                                        </div>
                                    )}

                                    {processStatus.status === 'error' && (
                                        <div className="mt-6 p-4 bg-red-50 rounded-lg">
                                            <p className="text-red-600">‚ùå {processStatus.error}</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Step 3: Analyze Matches */}
                            {currentStep === 3 && (
                                <div className="bg-white rounded-lg p-8 card-shadow">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800">
                                        ü§ñ Step 3: AI Analysis
                                    </h2>
                                    
                                    <div className="text-center">
                                        <div className="mb-6">
                                            <i className="fas fa-brain text-6xl text-blue-500 mb-4"></i>
                                            <p className="text-lg text-gray-600 mb-4">
                                                Ready to analyze your resume against collected jobs using AI
                                            </p>
                                        </div>

                                        <button
                                            onClick={analyzeMatches}
                                            disabled={processStatus.status === 'processing'}
                                            className="bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-8 py-4 rounded-lg text-lg transition-colors"
                                        >
                                            {processStatus.status === 'processing' ? 'Analyzing...' : 'üîç Start AI Analysis'}
                                        </button>

                                        {processStatus.status === 'processing' && (
                                            <div className="mt-6">
                                                <ProgressBar 
                                                    progress={processStatus.progress} 
                                                    message={processStatus.message} 
                                                />
                                            </div>
                                        )}

                                        {processStatus.status === 'error' && (
                                            <div className="mt-6 p-4 bg-red-50 rounded-lg">
                                                <p className="text-red-600">‚ùå {processStatus.error}</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Step 4: Results */}
                            {currentStep === 4 && results && (
                                <div>
                                    <div className="bg-white rounded-lg p-8 card-shadow mb-6">
                                        <div className="flex justify-between items-center mb-6">
                                            <h2 className="text-2xl font-bold text-gray-800">
                                                ‚úÖ Analysis Complete!
                                            </h2>
                                            <div className="flex space-x-3">
                                                <button
                                                    onClick={() => downloadFile('analysis_results.json')}
                                                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"
                                                >
                                                    üìÑ Download JSON
                                                </button>
                                                <button
                                                    onClick={() => downloadFile('job_match_report.txt')}
                                                    className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"
                                                >
                                                    üìã Download Report
                                                </button>
                                                <button
                                                    onClick={resetProcess}
                                                    className="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors"
                                                >
                                                    üîÑ Start Over
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <JobResults results={results} summary={summary} />
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
